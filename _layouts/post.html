---
layout: default
---

<section class="hero-gallery">
  {% assign folder = page.image_folder %}
  {% assign images = "" | split: "" %}

  {% for file in site.static_files %}
    {% if file.path contains folder %}
      {% assign images = images | push: file.path %}
    {% endif %}
  {% endfor %}

  {% if images.size > 0 %}
  <div class="slider">
    <button class="nav prev">&#10094;</button>

    <div class="slide-container">
      {% for img in images %}
        <img class="slide {% if forloop.first %}active{% endif %}"
             src="{{ img | relative_url }}"
             loading="lazy"
             decoding="async">
      {% endfor %}
    </div>

    <div class="gallery-info">
      <span class="image-counter"></span>
      <span class="image-resolution"></span>
    </div>

    <button class="nav next">&#10095;</button>
  </div>
  {% endif %}
</section>

<section class="post-content">
  <div class="post-container">

    <header class="post-header">
      <h1 class="post-title">{{ page.title }}</h1>
      <p class="post-date">{{ page.date | date: "%B %d, %Y" }}</p>
    </header>

    <article class="post-body">
      {{ content }}
    </article>

  </div>
</section>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
  <span class="close">&times;</span>
  <img class="lightbox-img" id="lightbox-img">
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

  const slides = document.querySelectorAll(".slide");
  const next = document.querySelector(".next");
  const prev = document.querySelector(".prev");
  const slider = document.querySelector(".slider");
  const lightbox = document.getElementById("lightbox");
  const lightboxImg = document.getElementById("lightbox-img");
  const closeBtn = document.querySelector(".close");
  const counterEl = document.querySelector(".image-counter");
  const resolutionEl = document.querySelector(".image-resolution");

  if (slides.length === 0) return;

  let index = 0;
  let touchStartX = 0;
  let touchEndX = 0;
  let navTimeout;

  /* ========================= */
/* GLOBAL IMAGE LOADING BAR */
/* ========================= */

const progressBar = document.getElementById("progressBarTop");

function setupImageLoader() {
  const images = document.querySelectorAll("img");
  let loaded = 0;
  const total = images.length;

  if (!progressBar || total === 0) return;

  function updateProgress() {
    loaded++;
    const percent = (loaded / total) * 100;
    progressBar.style.width = percent + "%";

    if (loaded === total) {
      setTimeout(() => {
        progressBar.style.width = "0%";
      }, 400);
    }
  }

  images.forEach(img => {
    if (img.complete) {
      updateProgress();
    } else {
      img.addEventListener("load", updateProgress);
      img.addEventListener("error", updateProgress);
    }
  });
}

setupImageLoader();
  
  /* ========================= */
  /* CORE FUNCTIONS */
  /* ========================= */

  function preloadImage(i) {
    const img = new Image();
    img.src = slides[i].src;
  }

  function updateInfo(i) {
    const img = slides[i];
    counterEl.textContent = `${i + 1} / ${slides.length}`;

    if (img.naturalWidth) {
      resolutionEl.textContent =
        `${img.naturalWidth} Ã— ${img.naturalHeight}`;
    }
  }

  function showSlide(i) {
    slides.forEach(slide => slide.classList.remove("active"));
    slides[i].classList.add("active");

    updateInfo(i);

    // Preload neighbors
    preloadImage((i + 1) % slides.length);
    preloadImage((i - 1 + slides.length) % slides.length);

    showNavTemporarily();
  }

  function nextSlide() {
    index = (index + 1) % slides.length;
    showSlide(index);
  }

  function prevSlide() {
    index = (index - 1 + slides.length) % slides.length;
    showSlide(index);
  }

  showSlide(index);

  /* ========================= */
  /* NAVIGATION */
  /* ========================= */

  next?.addEventListener("click", nextSlide);
  prev?.addEventListener("click", prevSlide);

  // Keyboard support
  document.addEventListener("keydown", e => {
    if (e.key === "ArrowRight") nextSlide();
    if (e.key === "ArrowLeft") prevSlide();
  });

  /* ========================= */
  /* SWIPE SUPPORT */
  /* ========================= */

  slider.addEventListener("touchstart", e => {
    touchStartX = e.changedTouches[0].screenX;
  });

  slider.addEventListener("touchend", e => {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
  });

  function handleSwipe() {
    const threshold = 50;
    if (touchEndX < touchStartX - threshold) nextSlide();
    if (touchEndX > touchStartX + threshold) prevSlide();
  }

  /* ========================= */
  /* AUTO HIDE NAV */
  /* ========================= */

  function showNavTemporarily() {
    document.querySelectorAll(".nav").forEach(btn => {
      btn.style.opacity = "1";
    });

    clearTimeout(navTimeout);

    navTimeout = setTimeout(() => {
      document.querySelectorAll(".nav").forEach(btn => {
        btn.style.opacity = "0";
      });
    }, 2000);
  }

  slider.addEventListener("mousemove", showNavTemporarily);
  slider.addEventListener("touchstart", showNavTemporarily);

  /* ========================= */
  /* LIGHTBOX */
  /* ========================= */

  slides.forEach(slide => {
    slide.addEventListener("click", () => {
      lightbox.classList.add("active");
      lightboxImg.src = slide.src;
    });
  });

  closeBtn?.addEventListener("click", () => {
    lightbox.classList.remove("active");
  });

  lightbox.addEventListener("click", e => {
    if (e.target === lightbox) {
      lightbox.classList.remove("active");
    }
  });

});
</script>
